<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1" />

<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js" ></script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/jszip.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.8.0/xlsx.js"></script>

<style type="text/css">\
	@import url(https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700);
	@font-face {
	    font-family: 'orig_fbshomreymishkal_bold';
	    src: url('https://priti1617.github.io/widgets/show_schedular/css/fonts/FbShomreyMishkal-Regular.eot');
	    src: url('https://priti1617.github.io/widgets/show_schedular/css/fonts/FbShomreyMishkal-Regular.eot?#iefix') format('embedded-opentype'),
	         url('https://priti1617.github.io/widgets/show_schedular/css/fonts/FbShomreyMishkal-Regular.woff2') format('woff2'),
	         url('https://priti1617.github.io/widgets/show_schedular/css/fonts/FbShomreyMishkal-Regular.woff') format('woff'),
	         url('https://priti1617.github.io/widgets/show_schedular/css/fonts/FbShomreyMishkal-Regular.svg#Fb ShomreyMishkal') format('svg');
	}

	@font-face {
	    font-family: wf_1dfd06caba28470bbba2400e1;
	    src: url("https://priti1617.github.io/widgets/show_schedular/css/fonts/2400e1.woff2") format("woff2"),
	    url("https://priti1617.github.io/widgets/show_schedular/css/fonts/2400e1.woff") format("woff"),
	    url("https://priti1617.github.io/widgets/show_schedular/css/fonts/2400e1.ttf") format("ttf");
	}
	@font-face {
	    font-family: wf_8a172f3e792844d09a56ab4ca;
	    src: url("https://priti1617.github.io/widgets/show_schedular/css/fonts/a56ab4ca.woff2") format("woff2"),
	    url("https://priti1617.github.io/widgets/show_schedular/css/fonts/a56ab4ca.woff") format("woff"),
	    url("https://priti1617.github.io/widgets/show_schedular/css/fonts/a56ab4ca.ttf") format("ttf");
	}
		/* written by riliwan balogun https://www.facebook.com/riliwan.rabo*/
		.shomrey{
			font-family: wfont_099e17_1dfd06caba28470bbba2400e114adf89,wf_1dfd06caba28470bbba2400e1,orig_fbshomreymishkal_bold !important;
		}
		.board{
		    width: 75%;
			margin: 60px auto;
			background: #fff;
		/*box-shadow: 10px 10px #ccc,-10px 20px #ddd;*/
		}
		.board .nav-tabs {
		    position: relative;
		    /* border-bottom: 0; */
		    /* width: 80%; */
		    margin: 0 auto;
		    margin-bottom: 0;
		    box-sizing: border-box;

		}

		.board > div.board-inner{
		    background: #fafafa url(https://subtlepatterns.com/patterns/geometry2.png);
		    background-size: 30%;
		}

		p.narrow{
		    width: 60%;
		    margin: 10px auto;
		}

		.liner{
		    height: 2px;
		    background: #ddd;
		    position: absolute;
		    width: 80%;
		    margin: 0 auto;
		    left: 0;
		    right: 0;
		    top: 50%;
		    z-index: 1;
		}

		.nav-tabs > li.active > a, .nav-tabs > li.active > a:hover, .nav-tabs > li.active > a:focus {
		    color: #555555;
		    cursor: default;
		    /* background-color: #ffffff; */
		    border: 0;
		    border-bottom-color: transparent;
		}

		span.round-tabs{
		    width: 48px;
		    height: 48px;
		    line-height: 48px;
		    display: inline-block;
		    border-radius: 100px;
		    background: white;
		    z-index: 2;
		    position: absolute;
		    left: 0;
		    text-align: center;
		    font-size: 25px;
		}

		span.round-tabs.one{
		    color: rgb(34, 194, 34);border: 2px solid rgb(34, 194, 34);
		}

		li.active span.round-tabs.one{
		    background: #fff !important;
		    border: 2px solid #ddd;
		    color: rgb(34, 194, 34);
		}

		span.round-tabs.two{
		    color: #febe29;
/*		    border: 2px solid #febe29;*/
		}

		li.active span.round-tabs.two{
		    background: #fff !important;
		    border: 2px solid #ddd;
		    color: #febe29;
		}

		span.round-tabs.three{
		    color: #3e5e9a;
/*		    border: 2px solid #3e5e9a;*/
		}

		li.active span.round-tabs.three{
		    background: #dfe9fe !important;
/*		    border: 2px solid #ddd;*/
		    border: 2px solid #3e5e9a;
		    color: #3e5e9a;
		    font-weight: bold;
		}

		span.round-tabs.four{
		    color: #f1685e;border: 2px solid #f1685e;
		}

		li.active span.round-tabs.four{
		    background: #fff !important;
		    border: 2px solid #ddd;
		    color: #f1685e;
		}

		span.round-tabs.five{
		    color: #999;border: 2px solid #999;
		}

		li.active span.round-tabs.five{
		    background: #fff !important;
		    border: 2px solid #ddd;
		    color: #999;
		}

		.nav-tabs > li.active > a span.round-tabs{
		    background: #fafafa;
		}
		.nav-tabs > li {
		    width: 14%;
		}
		/*li.active:before {
		    content: " ";
		    position: absolute;
		    left: 45%;
		    opacity:0;
		    margin: 0 auto;
		    bottom: -2px;
		    border: 10px solid transparent;
		    border-bottom-color: #fff;
		    z-index: 1;
		    transition:0.2s ease-in-out;
		}*/
		.nav-tabs > li:after {
		    content: " ";
		    position: absolute;
		    left: 45%;
		   opacity:0;
		    margin: 0 auto;
		    bottom: 0px;
		    border: 5px solid transparent;
		    border-bottom-color: #ddd;
		    transition:0.1s ease-in-out;
		    
		}
		.nav-tabs > li.active:after {
		    content: " ";
		    position: absolute;
		    left: 45%;
		   opacity:1;
		    margin: 0 auto;
		    bottom: 0px;
		    border: 10px solid transparent;
		    border-bottom-color: #ddd;
		    
		}
		.nav-tabs > li a{
		   width: 48px;
		   height: 48px;
		   margin: 20px auto;
		   border-radius: 100%;
		   padding: 0;
		   margin-top: 40px;
		}

		.nav-tabs > li a:hover{
		    background: transparent;
		}

		.tab-content{
		}
		.tab-pane{
		   position: relative;
			padding-top: 15px;
		}
		.tab-content .head{
		    font-family: 'Roboto Condensed', sans-serif;
		    font-size: 25px;
		    text-transform: uppercase;
		    padding-bottom: 10px;
		}
		.btn-outline-rounded{
		    padding: 10px 40px;
		    margin: 20px 0;
		    border: 2px solid transparent;
		    border-radius: 25px;
		}

		.btn.green{
		    background-color:#5cb85c;
		    /*border: 2px solid #5cb85c;*/
		    color: #ffffff;
		}



		@media( max-width : 585px ){
		    
		    .board {
				width: 90%;
				height:auto !important;
			}
		    span.round-tabs {
		        font-size:16px;
				width: 30px;
				height: 30px;
				line-height: 30px;
			}
			.tab-content .head{
		        font-size:20px;
			}
			.nav-tabs > li a {
				width: 30px;
				height: 30px;
				line-height:30px;
			}

			.nav-tabs > li.active:after {
				content: " ";
				position: absolute;
				left: 35%;
			}

			.btn-outline-rounded {
			    padding:12px 20px;
		    }
		}

		#calendarSchedule .nav-tabs>li {
			display: inline-block !important;
			float: unset;
		}
		.nav-tabs>li>a {
			border: unset !important;
		}
		.nav-tabs>li.active>a, .nav-tabs>li.active>a:focus, .nav-tabs>li.active>a:hover {
			background: unset !important;
		}
		.dayTextDiv {
			text-align: center;
		    position: absolute;
   			width: 100%;
   			margin-top: 15px;
   			font-size: 18px;
		}

		.single-show .showwrap{
			overflow: hidden;
		    display: flex;
		    z-index: 2;
		    border-radius: 8px;
		    -webkit-transition: all .5s ease;
		    -moz-transition: all .5s ease;
		    -ms-transition: all .5s ease;
		    -o-transition: all .5s ease;
		    transition: all .5s ease;
		    padding: 8px 24px 8px 8px;
		    border-bottom: 1px solid #ddd;
		}

		.single-show:hover .showwrap {
		    background-color: #fff;
		    box-shadow: 0 7px 20px -10px rgb(20 20 20 / 30%);
		}

		.single-show .show_date {
		    margin-left: 28px;
		    display: flex;
		    align-items: center;
		    justify-content: center;
		}

		.single-show .dateDiv {
		    padding: 4px;
		    text-align: center;
		    width: 122px;
		    border-radius: 8px;
		    font-size: 24px;
		    color: #292929;
		}

		.single-show .showImage {
		    position: relative;
		    display: inline-block;
		    vertical-align: middle;
		    width: 105px;
		    height: 176px;
		}

		.single-show img {
			position: absolute;
		    top: 0;
		    bottom: 0;
		    margin: auto;
		    width: 120px;
		    height: auto;
		    object-fit: cover;
		    border: 1px solid #eeeeee;
		}

		.single-show .showContent {
		    background-color: #fff;
		    flex: 1;
		    display: flex;
		    align-items: center;
		    padding: 0 0 0 48px;
		    border-radius: 8px 0 0 8px;
		    -webkit-transition: all .5s ease;
		    -moz-transition: all .5s ease;
		    -ms-transition: all .5s ease;
		    -o-transition: all .5s ease;
		    transition: all .5s ease;
		}
		.showContent {
		    line-height: 1.35;
		}
		.single-show .contentDiv {
		    height: 100%;
		    padding: 24px;
		    flex: 1;
		}
		.single-show .show_Name {
		    font-size: 32px;
		}
		.single-show .show_Desc {
		    font-size: 22px;
		    color: #707070;
		} 
		.single-show .show_Announcer {
		    font-size: 22px;
		    color: #707070;
		} 
		.show_Announcer .icon
		{
			font-size: 16px;
		}
		.single-show.live .show_date .dateDiv {
			background-color: #f2dede;
		}
		.single-show.live .show_date a:hover .dateDiv {
			background-color: #f6d3d3;
		}
		.floatbtn {
			background: #00A9FF;
		    position: absolute;
		    border: 0;
		    top: 42px;
		    right: -120px;
		}
		.floatbtn_span2{
			display: inline-block;padding-right: 5px;font-size: 18px;vertical-align: middle;
		}

		@media only screen and (min-width: 601px) {
			.single-show .mobile {
				display: none;
			}
		}

		@media only screen and (max-width: 600px) {
			.container{
				width: 100% !important;
				    padding-right: 0px; 
    				padding-left: 0px;
			}
			.row {
			    margin-right: 0px;
			    margin-left: 0px;
			}
			.board{
			    width: 100%;
			    margin: 0px auto;

			}
		  .board .nav-tabs {
		    margin:0;
		    padding:0;
		  }
		  .dayTextDiv {
		  	font-size: 14px;
		  }
		  span.round-tabs{
		    width: 30px;
		    height: 30px;
		    line-height: 30px;
		  }
		  .nav-tabs > li a{
			   width: 30px;
			   height: 30px;
			}
			.single-show img{
				width: 75px;
			}
			.single-show .showImage{
				width: 84px;
				height: auto;
			}
			.single-show .contentDiv {
			    height: auto;
			    padding: 0px;
			}
			.single-show .dateDiv {
		        width: 88px;
			    font-size: 17px;
			    margin-left: 5px;
			}
			.single-show .show_date{
				margin-left: 0px;
			}
			.single-show .showContent{
				padding: 0;
			}
			.single-show .show_Name{
				font-size: 20px;
			}
			.single-show .show_Desc{
				font-size: 14px;
			}
			.single-show .show_Announcer{
				font-size: 14px;
			}
			.single-show .desktop {
				display: none;
			}
			.single-show .showwrap{
				padding: 8px;
			}
			.floatbtn {
				top: 98px;
			    right: 0px;
			    font-size: 12px;
			    padding: 3px 6px;
			    z-index: 1;
			}
			.floatbtn_span2{
				padding-right: 4px;
				font-size: 14px;
			}
		}
</style>
<div id="calendarSchedule" class="shomrey"></div>
<script type="text/javascript">
	var url = "https://galrabino.github.io/radiosol/schedule.xlsx";

	var schedule;
    var oReq = new XMLHttpRequest();
    oReq.open("GET", url, true);
    oReq.responseType = "arraybuffer";
    oReq.onload = function(e) {
        var arraybuffer = oReq.response;

        /* convert data to binary string */
        var data = new Uint8Array(arraybuffer);

        var arr = new Array();
        for (var i = 0; i != data.length; ++i) {
            arr[i] = String.fromCharCode(data[i]);
        }

        var bstr = arr.join("");

        var cfb = XLSX.read(bstr, { type: 'binary' });

        cfb.SheetNames.forEach(function(sheetName, index) {

            // Obtain The Current Row As CSV
            var fieldsObjs = XLS.utils.sheet_to_json(cfb.Sheets[sheetName]);

            schedule = fieldsObjs;

        });

        schedule.sort(function(a,b){
        	if((a.day - b.day)>0) return 1;
        	else if((a.day - b.day)<0) return -1;
        	else{
	        	if((a.start.replace(":",".")-b.start.replace(":","."))>0) return 1; 
	        	else if((a.start.replace(":",".")-b.start.replace(":","."))<0) return -1;
	        	else 0;        		
        	}
        });
        setCalHtml();
    }

    oReq.send();

    function getNewDateObj(offset,relativeDays) {
	    // create Date object for current location
	    var d = new Date();

	    // convert to msec
	    // subtract local time zone offset
	    // get UTC time in msec
	    var utc = d.getTime() + (d.getTimezoneOffset() * 60000);

	    // create new Date object for different city
	    // using supplied offset
	    var nd = new Date(utc + (3600000*offset));
	    if(relativeDays<0 || relativeDays>0) 
	    	nd.setDate(nd.getDate()+relativeDays);

	    // return time as a string
	    return nd;
	}
</script>


<script type="text/javascript">

		var dates = [];
		var dayTexts = ["יום ראשון", "יום שני", "יום שלישי", "יום רביעי", "יום חמישי", "יום שישי", "יום שבת"], todayText="היום";

		var dates = [
			{ date: getNewDateObj("+2").getDate(), day: todayText, dayInt: getNewDateObj("+2").getDay()},
			{ date: getNewDateObj("+2",1).getDate(), day: dayTexts[getNewDateObj("+2",1).getDay()], dayInt: getNewDateObj("+2",1).getDay()},
			{ date: getNewDateObj("+2",2).getDate(), day: dayTexts[getNewDateObj("+2",2).getDay()], dayInt: getNewDateObj("+2",2).getDay()},
			{ date: getNewDateObj("+2",3).getDate(), day: dayTexts[getNewDateObj("+2",3).getDay()], dayInt: getNewDateObj("+2",3).getDay()},
			{ date: getNewDateObj("+2",4).getDate(), day: dayTexts[getNewDateObj("+2",4).getDay()], dayInt: getNewDateObj("+2",4).getDay()},
			{ date: getNewDateObj("+2",5).getDate(), day: dayTexts[getNewDateObj("+2",5).getDay()], dayInt: getNewDateObj("+2",5).getDay()},
			{ date: getNewDateObj("+2",6).getDate(), day: dayTexts[getNewDateObj("+2",6).getDay()], dayInt: getNewDateObj("+2",6).getDay()},
		];

	function getLiveShowIndex() 
	{
		try{
			var dtObj = getNewDateObj("+2");

			var day = dtObj.getDay();
			var hour = dtObj.getHours();
			var minute = dtObj.getMinutes();

			for(var i=0; i < schedule.length; i++) {
				if(parseInt(schedule[i].day)===day){
					var h_start = parseInt(schedule[i].start.split(":")[0]);
					var m_start = parseInt(schedule[i].start.split(":")[1]);
					var h_end = parseInt(schedule[i].end.split(":")[0]);
					var m_end = parseInt(schedule[i].end.split(":")[1]);

					if(h_start<=hour && hour<h_end && m_start<=minute){
						return i;
					}
					else continue
				}
				else continue;
			}
			return false;
		}
		catch(e){ }	
		return false;
	}

	function fnBrowserDetect(){
                 
         let userAgent = navigator.userAgent;
         let browserName;
         
         if(userAgent.match(/chrome|chromium|crios/i)){
             browserName = "chrome";
           }else if(userAgent.match(/firefox|fxios/i)){
             browserName = "firefox";
           }  else if(userAgent.match(/safari/i)){
             browserName = "safari";
           }else if(userAgent.match(/opr\//i)){
             browserName = "opera";
           } else if(userAgent.match(/edg/i)){
             browserName = "edge";
           }else{
             browserName="No browser detection";
           }
         
          return browserName;        
  }

	function scrollToLiveDiv() {
		// document.querySelector("#todayDate").click();
		// setTimeout(function () {
			if(window===window.parent){
				const y = document.getElementById("liveshowRowDiv").getBoundingClientRect().top + window.scrollY;
				window.scroll({
				  top: y,
				  behavior: 'smooth'
				});;			
			}
			else {
				var browser = fnBrowserDetect();
				if(browser=="safari"){
					document.getElementById("liveshowRowDiv").scrollIntoView();
				}
				else{
					document.getElementById("liveshowRowDiv").scrollIntoView({
			            behavior: "smooth"
			        });					
				}
			}
		// },500);
		return false;
	}

	function setCalHtml() {
		for (var i = 0; i < dates.length; i++) {
			var dayInt = dates[i].dayInt;
			if(!dates[i].content) dates[i].content = "";
			var liveIndex = getLiveShowIndex(), liveIndexMarked=false;
			for (var j = 0; j < schedule.length; j++) {
				if(parseInt(schedule[j].day)!==dayInt)
					continue;
				if(schedule[j].start=="0:00") schedule[j].start="00:00";
				if(schedule[j].end=="0:00") schedule[j].end="00:00";
				
				var liveClass = "",dateStr="", liveAttrs="";
				if (!liveIndexMarked && liveIndex===j) {
					liveIndexMarked = true;
					liveClass = "live";
					liveAttrs = "id='liveshowRowDiv'";
					dateStr = `<a href="https://radio.streamgates.net/stream/sol" target="_blank" style="text-decoration: none;"><div class="dateDiv">
								`+schedule[j].start+`
								<span class="badge bg-primary" style="background-color: red;display: block;margin-top: 5px;">LIVE</span><span style="padding: 5px 0px;display: inline-block;"><i class="glyphicon glyphicon-play-circle"></i></span>
							</div></a>`;
				}
				else dateStr = `<div class="dateDiv">`+schedule[j].start+` - `+schedule[j].end+`</div>`;

				dates[i].content += `<div class="single-show `+liveClass+`" `+liveAttrs+`>
								<div class="showwrap">
									<div class="show_date">`+dateStr+`</div>
									<div class="showImage">
										<img width="101" height="120" src="`+schedule[j].photo_url+`" class="" alt="" decoding="async"  />									
									</div>
									<div class="showContent">
										<div class="contentDiv">
											<div class="titles">
												<h4 class="show_Name">`+schedule[j].show+`</h4>
												<div class="show_Desc">
													<span class="bold">`+schedule[j].oneline4show+`</span>
												</div>`+((schedule[j].announcer)?(
												`<div class="show_Announcer">
													<span class="bold">`+schedule[j].announcer+`</span>
												</div>`):``	
												)+`												
											</div>
											<a href="`+schedule[j].show_link+`" target="_blank" class="btn btn-default mobile">
												<span class="text">מעבר לדף התכנית</span>
											</a>
										</div>
										<a href="`+schedule[j].show_link+`" target="_blank" class="btn btn-default desktop">
											<span class="text">מעבר לדף התכנית</span>
										</a>
									</div>
								</div>
							</div>`;
			}
		}

		var sliderStr = "";
		var showContent = "";
		for (var i = 0; i < dates.length; i++) {
			var activeClass = "",todayAttrs="";
			if(i==0) {
				activeClass="active";
				todayAttrs = "id='todayDate'";
			}
			sliderStr += `<li class="`+activeClass+`">
							<div class="dayTextDiv">`+dates[i].day+`</div>
							<a href="#dateTab`+i+`" data-toggle="tab" title=""  `+todayAttrs+`>
			                     <span class="round-tabs three">
			                        `+dates[i].date+`
			                     </span> 
			           		</a>
	                 </li>`;
	        showContent += `<div class="tab-pane fade in `+activeClass+`" id="dateTab`+i+`">
	        				`+dates[i].content+`
	                      </div>`;
		}

		var htmlStr = `<section style="background:#efefe9;" dir="rtl">
	        <div class="container" style="width:98%;">
	            <div class="row">
	                <div class="board" style="position:relative;">
	                	<a class="btn btn-primary floatbtn" onclick="scrollToLiveDiv();">
						    	<span style="vertical-align: middle;">עכשיו בשידור חי</span><span class="floatbtn_span2"><i class="glyphicon glyphicon-play-circle"></i>
						    	</span> 
						    </a>
	                    <!-- <h2>Welcome to IGHALO!<sup>™</sup></h2>-->
	                    <div class="board-inner">
	                    <ul class="nav nav-tabs" id="myTab">
	                     `+sliderStr+`
	                     </ul></div>

	                     <div class="tab-content" style="margin-bottom: 20px;">
	                        `+showContent+`                  
							<div class="clearfix"></div>
						</div>
			</div>
			</div>
			</div>
			</section>`;
			document.querySelector("#calendarSchedule").innerHTML = htmlStr;
	}
	
</script>